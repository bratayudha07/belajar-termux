#!/usr/bin/env zsh
# ==================================================
# FILE: ~/.autostart
# PURPOSE:
#   - Force underline cursor (zsh, Termux)
#   - Keep SSH agent block (commented)
#   - Run rxfetch on interactive shell (EXCEPT inside nvim)
# ==================================================

# Jalankan hanya di shell interaktif
[[ -o interactive ]] || return

# --------------------------------------------------
# ENV dasar
# --------------------------------------------------
export COLUMNS LINES

# --------------------------------------------------
# FORCE CURSOR UNDERLINE (terminal escape sequence)
# --------------------------------------------------
_fix_cursor() {
  # Pastikan output ke terminal
  [[ -t 1 ]] || return

  # ESC [ 4 q  -> underline steady
  printf '\e[4 q'
}

# Set cursor setiap kali prompt muncul (zsh-native)
precmd_functions+=(_fix_cursor)

# Set sekali saat shell pertama kali load (aman & cepat)
_fix_cursor

# --------------------------------------------------
# RXFETCH (Diupdate)
# --------------------------------------------------
# Tampilkan system info sekali saat shell start
# HANYA jika rxfetch terinstall DAN TIDAK didalam Neovim
if command -v rxfetch >/dev/null 2>&1 && [[ -z "$NVIM" ]]; then
  rxfetch
fi

# ==================================================
# SSH AGENT (DIKOMENTARI - JANGAN DIHAPUS)
# ==================================================

# SSH Agent (opsional)
# SSH_ENV="${HOME}/.ssh/agent-environment"
# function start_agent {
#   termux-toast -b "#FFFFFF" -c "#000000" -g top "Initialising new SSH Agent" &> /dev/null
#   ssh-agent | sed 's/^echo/#echo/' > "${SSH_ENV}"
#   termux-toast -b "#FFFFFF" -c "#000000" -g top "Succeeded" &> /dev/null
#   chmod 600 "${SSH_ENV}"
#   . "${SSH_ENV}" > /dev/null
#   ssh-add
# }
# if [ -f "${SSH_ENV}" ]; then
#   . "${SSH_ENV}" > /dev/null
#   ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ > /dev/null || {
#     start_agent
#   }
# else
#   start_agent
# fi

# ==================================================
# END
# ==================================================
